---
layout: post
title: "回路内導通チェッカ"
date: 2016-02-10 03:01:12 -0800
categories: Make
---
作った回路をチェックするのに、目視では限界があるし、
テスタの導通チェックモードでは、3.3V系のチェックをするのは難しい時がある。

そこで、ELMさんの[回路内導通チェッカ](http://elm-chan.org/works/cch/report.html)を制作してみた。

![回路検査機](/assets/2016-02-10-circuit-checker/cch.jpg)

元の回路図を元に制作したが、テストプローブ以外はありあわせの物であるため、いくつか変更点がある。

- MCUをATTiny13からATTiny45へ変更。
- 分圧している抵抗を、27kΩと5.6kΩの組から、12kΩと2kΩの組み合わせに変更。
- 電池をCR2032から単三電池2本に変更。

Tiny45はTiny13に比べて値段が3倍、フラッシュが4倍あるから大袈裟。
単三電池も、電力のほとんどが自己放電で使われる気がする。
オーバーキルだ。

出力インピーダンスがちょっと低くなってるのはどういう影響があるのかちょっと自信がない。

ケースはアルトイズのでかい版にした。
横にフタがあるやつのほうがピッタリな気がするが、
ピッタリすぎて電池ボックスが取れなくなりそうなのでやめた。
原作のように、ボタン電池を使うなら、ちっちゃい方の缶でもおさまると思う。
ドリルで簡単に穴があけられるので、このようなものを作るにはピッタリのケースだ。

ファームウエアは次の変更をした。

- MakefileのMCU_TARGETをattiny13からattiny45へ。
- ADMUXの立てる必要があるビットがtiny13とtiny45で違うので、REFS0からREFS1に変更。
- フューズはLを0xE4に変更、Hは0xDFのまま。

ハマった所は以下の所。

- 最初、1MHzで動かそうとして定数をいじったら、オーバーフローして正常に動かなかった。原作通り128khz動作に戻した。
- hidaspxでフューズをいじっていたら認識されなくなってビビった。128khz動作する場合、-d20などのオプションをつけてゆっくり書き込む必要がある。
- 電池にするか、USB駆動にするか悩んでいて、分圧抵抗を両方の分計算した上で、電池にすると決め、USB用の計算結果を使ってしまった。
- 同じく、LED用の電流制限抵抗を、5V電源で計算してたが、実際は電池3Vだったため、光らなかった。
